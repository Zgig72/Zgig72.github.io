<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Launch Pad</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            flex-direction: column;
            margin: 0;
            background: url('teacherbackground.png');
            background-size: 100% 100vh;
        }
    </style>
</head>
<body>
    <div id="launchpad">
        <h1>Launch Pad</h1>
        <button id="host-button">Host Game</button>
        <p id="host-code"></p>

        <div id="student-list">
            <h2>Joined Students:</h2>
            <ul id="students"></ul>
        </div>
    </div>
    <button id="start-button" style="display:none;">Start Game</button>

    <div class="counter">Class Matches: <span id="matches">0</span></div>
    <div class="leaderboard">
        <h3>Top Engineers</h3>
        <ol id="leaderboard-list"></ol>
    </div>

    <audio id="success-sound" src="success.mp3"></audio>
    <audio id="fail-sound" src="fail.mp3"></audio>
    <audio id="win-sound" src="win.mp3"></audio>
    <audio id="tick-sound" src="tick.mp3"></audio>
    <audio id="background-music" src="background.mp3" loop></audio>

    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.3.2/dist/peerjs.min.js"></script>
    <script>
        let peer;
        let connections = [];
        let matches = 0;
        let leaderboard = {};

        function updateLeaderboard() {
            const sortedLeaderboard = Object.entries(leaderboard)
                .sort(([, a], [, b]) => b - a)
                .slice(0, 3);
            const leaderboardList = document.getElementById('leaderboard-list');
            leaderboardList.innerHTML = '';
            sortedLeaderboard.forEach(([name, count]) => {
                const li = document.createElement('li');
                li.textContent = `${name}: ${count}`;
                leaderboardList.appendChild(li);
            });
        }

        document.getElementById('host-button').onclick = () => {
            const code = generateCode();
            peer = new Peer(code);
            document.getElementById('host-code').textContent = `Game Code: ${code}`;

            peer.on('connection', conn => {
                connections.push(conn);
                conn.on('data', data => {
                    if (data.type === 'join') {
                        leaderboard[data.name] = 0;
                        const li = document.createElement('li');
                        li.textContent = data.name;
                        document.getElementById('students').appendChild(li);
                        console.log(`Student joined: ${data.name}`);
                    }

                    if (data.type === 'match-complete') {
                        leaderboard[data.name]++;
                        matches++;
                        document.getElementById('matches').textContent = matches; // Update class matches counter
                        updateLeaderboard(); // Update leaderboard
                    }
                });

                document.getElementById('start-button').style.display = 'block';
            });
        };

        document.getElementById('start-button').onclick = () => {
            connections.forEach(conn => conn.send({ type: 'start' }));
            console.log('Game started');
        };

        function generateCode() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }
    </script>
</body>
</html>